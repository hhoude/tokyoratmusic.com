// index.jsx
import React, { useEffect, useRef, useState } from 'react';

const TokyoRatLanding = () => {
  const [cursorPosition, setCursorPosition] = useState({ x: 0, y: 0 });
  const [currentText, setCurrentText] = useState('');
  const [currentIndex, setCurrentIndex] = useState(0);
  const [binaryMatrices, setBinaryMatrices] = useState([]);
  const canvasRef = useRef(null);
  
  const phrases = ['MUSIC', 'VINYL', 'COMIC', 'MERCH'];

  useEffect(() => {
    // Cursor tracking
    const handleMouseMove = (e) => {
      setCursorPosition({ x: e.clientX, y: e.clientY });
    };
    window.addEventListener('mousemove', handleMouseMove);

    // Canvas noise effect
    const canvas = canvasRef.current;
    const ctx = canvas.getContext('2d');
    
    const resizeCanvas = () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    };

    const generateNoise = () => {
      const imageData = ctx.createImageData(canvas.width, canvas.height);
      const data = imageData.data;
      
      for (let i = 0; i < data.length; i += 4) {
        const value = Math.random() * 255;
        data[i] = value;
        data[i + 1] = value;
        data[i + 2] = value;
        data[i + 3] = 255;
      }
      
      ctx.putImageData(imageData, 0, 0);
      requestAnimationFrame(generateNoise);
    };

    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);
    generateNoise();

    // Binary matrix animation
    const interval = setInterval(() => {
      setBinaryMatrices(prev => {
        const newMatrix = {
          id: Math.random(),
          x: Math.random() * window.innerWidth,
          y: -50,
          content: Array(10).fill(0).map(() => Math.random() > 0.5 ? '1' : '0').join('')
        };
        return [...prev, newMatrix].slice(-30); // Keep last 30 matrices
      });
    }, 200);

    // Text reveal animation
    let textInterval;
    const startTextReveal = () => {
      let charIndex = 0;
      textInterval = setInterval(() => {
        if (charIndex < phrases[currentIndex].length) {
          setCurrentText(phrases[currentIndex].slice(0, charIndex + 1));
          charIndex++;
        } else {
          clearInterval(textInterval);
          setTimeout(() => {
            setCurrentText('');
            setCurrentIndex((prev) => (prev + 1) % phrases.length);
          }, 1000);
        }
      }, 200);
    };

    startTextReveal();

    return () => {
      window.removeEventListener('mousemove', handleMouseMove);
      window.removeEventListener('resize', resizeCanvas);
      clearInterval(interval);
      clearInterval(textInterval);
    };
  }, [currentIndex]);

  return (
    <div className="min-h-screen bg-black text-white font-mono overflow-hidden relative">
      {/* Custom Cursor */}
      <div 
        className="custom-cursor fixed pointer-events-none z-50"
        style={{
          left: `${cursorPosition.x}px`,
          top: `${cursorPosition.y}px`,
          transform: 'translate(-50%, -50%)'
        }}
      />

      {/* Noise Canvas */}
      <canvas 
        ref={canvasRef}
        className="fixed inset-0 opacity-10 pointer-events-none"
      />

      {/* Binary Rain Effect */}
      <div className="fixed inset-0 pointer-events-none overflow-hidden">
        {binaryMatrices.map(matrix => (
          <div
            key={matrix.id}
            className="absolute text-green-500 opacity-30 text-xs"
            style={{
              left: `${matrix.x}px`,
              top: `${matrix.y}px`,
              animation: 'fall 8s linear forwards'
            }}
          >
            {matrix.content}
          </div>
        ))}
      </div>

      {/* Main Content */}
      <main className="relative z-10 min-h-screen flex flex-col items-center justify-center p-4">
        {/* Logo */}
        <div className="relative w-64 h-64 mb-12">
          <div className="absolute inset-0">
            <img
              src="TR_mouse_fill_red.png"
              alt="Tokyo Rat Logo"
              className="w-full h-full object-contain"
            />
          </div>
          <div 
            className="absolute inset-0 glitch-1"
            style={{
              backgroundImage: 'url(TR_mouse_fill_red.png)',
              backgroundSize: 'contain',
              backgroundPosition: 'center',
              backgroundRepeat: 'no-repeat'
            }}
          />
          <div 
            className="absolute inset-0 glitch-2"
            style={{
              backgroundImage: 'url(TR_mouse_fill_red.png)',
              backgroundSize: 'contain',
              backgroundPosition: 'center',
              backgroundRepeat: 'no-repeat'
            }}
          />
        </div>

        {/* Title */}
        <h1 className="text-5xl md:text-6xl tracking-[0.5em] uppercase mb-8 animate-flicker">
          Tokyo Rat
        </h1>

        {/* Japanese Text */}
        <div className="text-xl md:text-2xl tracking-[0.2em] mb-12 text-red-600">
          東京ラット
        </div>

        {/* Coming Soon */}
        <div className="text-2xl md:text-3xl tracking-[0.3em] text-red-600 mb-12 animate-pulse">
          COMING SOON
        </div>

        {/* Revealing Text */}
        <div className="h-24 flex items-center justify-center">
          <div className="text-xl md:text-2xl relative">
            <span className="relative z-10">{currentText}</span>
            <span className="absolute top-0 left-0 text-red-500 opacity-50 transform translate-x-1">
              {currentText}
            </span>
            <span className="absolute top-0 left-0 text-cyan-500 opacity-50 transform -translate-x-1">
              {currentText}
            </span>
          </div>
        </div>
      </main>

      <style jsx global>{`
        * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
          cursor: none;
        }

        .custom-cursor {
          width: 32px;
          height: 32px;
          background-image: url('TR-Cursor-White-NoBG.png');
          background-size: contain;
          background-repeat: no-repeat;
          mix-blend-mode: difference;
        }

        @keyframes fall {
          0% { transform: translateY(0); }
          100% { transform: translateY(100vh); }
        }

        @keyframes flicker {
          0%, 19.999%, 22%, 62.999%, 64%, 64.999%, 70%, 100% { opacity: 1; }
          20%, 21.999%, 63%, 63.999%, 65%, 69.999% { opacity: 0.4; }
        }

        .animate-flicker {
          animation: flicker 4s infinite;
        }

        .animate-pulse {
          animation: pulse 2s infinite;
        }

        .glitch-1 {
          animation: glitch1 4s infinite;
          opacity: 0.7;
          mix-blend-mode: screen;
        }

        .glitch-2 {
          animation: glitch2 3s infinite;
          opacity: 0.7;
          mix-blend-mode: multiply;
        }

        @keyframes glitch1 {
          0%, 100% { transform: translate(0); }
          20% { transform: translate(2px, -2px); }
          40% { transform: translate(-2px, 2px); }
          60% { transform: translate(1px, -1px); }
          80% { transform: translate(-1px, 1px); }
        }

        @keyframes glitch2 {
          0%, 100% { transform: translate(0); }
          25% { transform: translate(-2px, 0) scale(1.02); }
          50% { transform: translate(2px, -1px) scale(0.98); }
          75% { transform: translate(-1px, 1px) scale(1.02); }
        }
      `}</style>
    </div>
  );
};

export default TokyoRatLanding;
