// index.jsx or App.jsx
import React, { useEffect, useRef, useState } from 'react';

// CSS for cursor and global styles
const globalStyles = `
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  cursor: none; /* Hide default cursor */
}

/* Add this to your CSS and make sure the path matches your image location */
.custom-cursor {
  width: 32px;
  height: 32px;
  background-image: url('/public/TR-Cursor-White-NoBG.png');
  background-size: contain;
  background-repeat: no-repeat;
  pointer-events: none;
  z-index: 9999;
  mix-blend-mode: difference;
}

@keyframes severe-glitch {
  0%, 100% { transform: translate(0) skew(0deg); }
  20% { transform: translate(-10px, 5px) skew(10deg); }
  40% { transform: translate(10px, -5px) skew(-5deg); }
  60% { transform: translate(-5px, 2px) skew(2deg); }
  80% { transform: translate(5px, -2px) skew(-8deg); }
}

@keyframes glitch-2 {
  0%, 100% { transform: translate(2px, 0); }
  50% { transform: translate(-2px, 2px); }
}

@keyframes glitch-3 {
  0%, 100% { transform: translate(-2px, 0); }
  50% { transform: translate(2px, -2px); }
}

@keyframes flicker {
  0%, 19.999%, 22%, 62.999%, 64%, 64.999%, 70%, 100% { opacity: 1; }
  20%, 21.999%, 63%, 63.999%, 65%, 69.999% { opacity: 0.4; }
}

@keyframes noise {
  0%, 100% { transform: translate(0); }
  10% { transform: translate(-5px, -5px); }
  20% { transform: translate(5px, 5px); }
  30% { transform: translate(-3px, 3px); }
  40% { transform: translate(3px, -3px); }
  50% { transform: translate(0); }
}

@keyframes fall {
  from { transform: translateY(0); }
  to { transform: translateY(100vh); }
}

.animate-fall {
  animation: fall 10s linear;
}
`;

const TokyoRatLanding = () => {
  const [cursorPosition, setCursorPosition] = useState({ x: 0, y: 0 });
  const [binaryMatrices, setBinaryMatrices] = useState([]);
  const [currentText, setCurrentText] = useState('');
  const [binaryText, setBinaryText] = useState('');
  const phrases = ['MUSIC', 'VINYL', 'COMIC', 'MERCH'];
  const [currentIndex, setCurrentIndex] = useState(0);
  const canvasRef = useRef(null);

  useEffect(() => {
    // Mouse movement handler
    const handleMouseMove = (e) => {
      setCursorPosition({ x: e.clientX, y: e.clientY });
    };
    window.addEventListener('mousemove', handleMouseMove);

    // Canvas noise effect
    const canvas = canvasRef.current;
    const ctx = canvas.getContext('2d');
    let animationFrameId;

    const resizeCanvas = () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    };

    const generateNoise = () => {
      const imageData = ctx.createImageData(canvas.width, canvas.height);
      const data = imageData.data;
      
      for (let i = 0; i < data.length; i += 4) {
        const value = Math.random() * 255;
        data[i] = value;
        data[i + 1] = value;
        data[i + 2] = value;
        data[i + 3] = 255;
      }
      
      ctx.putImageData(imageData, 0, 0);
      animationFrameId = requestAnimationFrame(generateNoise);
    };

    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);
    generateNoise();

    // Binary matrix generation
    const matrixInterval = setInterval(() => {
      setBinaryMatrices(prevMatrices => {
        const newMatrix = {
          id: Math.random(),
          x: Math.random() * window.innerWidth,
          y: -100,
          content: Array(10).fill(0).map(() => Math.random() > 0.5 ? '1' : '0').join('')
        };
        return [...prevMatrices, newMatrix].slice(-50);
      });
    }, 100);

    // Text reveal effect
    const generateBinary = () => {
      return Array(30).fill(0).map(() => Math.random() > 0.5 ? '1' : '0').join('');
    };

    let index = 0;
    const revealInterval = setInterval(() => {
      if (index < phrases[currentIndex].length) {
        setCurrentText(prev => phrases[currentIndex].slice(0, index + 1));
        setBinaryText(generateBinary());
        index++;
      } else {
        clearInterval(revealInterval);
        setTimeout(() => {
          if (currentIndex < phrases.length - 1) {
            setCurrentIndex(prev => prev + 1);
            setCurrentText('');
          }
        }, 1000);
      }
    }, 200);

    // Cleanup
    return () => {
      window.removeEventListener('mousemove', handleMouseMove);
      window.removeEventListener('resize', resizeCanvas);
      cancelAnimationFrame(animationFrameId);
      clearInterval(matrixInterval);
      clearInterval(revealInterval);
    };
  }, [currentIndex]);

  return (
    <div className="min-h-screen bg-black text-white font-mono overflow-hidden relative">
      {/* Custom Cursor */}
      <div 
        className="custom-cursor fixed"
        style={{ 
          left: `${cursorPosition.x - 16}px`,
          top: `${cursorPosition.y - 16}px`
        }}
      />

      {/* Noise Canvas */}
      <canvas 
        ref={canvasRef}
        className="fixed top-0 left-0 w-full h-full opacity-10 pointer-events-none z-0"
      />

      {/* Binary Matrices */}
      <div className="fixed inset-0 overflow-hidden pointer-events-none">
        {binaryMatrices.map(matrix => (
          <div
            key={matrix.id}
            className="absolute text-green-500 opacity-30 text-xs animate-fall"
            style={{
              left: matrix.x,
              top: matrix.y
            }}
          >
            {matrix.content}
          </div>
        ))}
      </div>

      {/* Main Content */}
      <div className="relative z-10 min-h-screen flex flex-col items-center justify-center p-4">
        {/* Logo */}
        <div className="relative w-48 h-48 mb-12">
          <div className="absolute inset-0 bg-red-600">
            <svg viewBox="0 0 100 100" className="w-full h-full">
              <path
                d="M50 20 C60 20 70 30 70 40 L70 60 C70 70 60 80 50 80 C40 80 30 70 30 60 L30 40 C30 30 40 20 50 20 Z M40 45 L60 45 L50 65 Z"
                fill="black"
                className="animate-[severe-glitch_2s_infinite]"
              />
            </svg>
          </div>
          <div className="absolute inset-0 bg-red-600 transform translate-x-2 opacity-80 animate-[glitch-2_4s_infinite]" />
          <div className="absolute inset-0 bg-cyan-500 transform -translate-x-2 opacity-50 animate-[glitch-3_3s_infinite]" />
        </div>

        {/* Title */}
        <h1 className="text-5xl tracking-[0.5em] uppercase mb-8 animate-[flicker_4s_infinite]">
          Tokyo Rat
        </h1>

        {/* Japanese Subtitle */}
        <div className="text-xl tracking-[0.2em] mb-12">
          東京ラット
        </div>

        {/* Coming Soon */}
        <div className="text-2xl tracking-[0.3em] text-red-600 mb-12 animate-[severe-glitch_2s_infinite]">
          COMING SOON
        </div>

        {/* Revealing Text */}
        <div className="h-24 flex items-center justify-center">
          <div className="text-xl relative">
            <span className="relative z-10">{currentText}</span>
            <span className="absolute top-0 left-0 text-red-500 opacity-50 transform translate-x-1">
              {currentText}
            </span>
            <span className="absolute top-0 left-0 text-cyan-500 opacity-50 transform -translate-x-1">
              {currentText}
            </span>
            <div className="text-xs opacity-50 mt-2">{binaryText}</div>
          </div>
        </div>
      </div>

      <style jsx global>
        {globalStyles}
      </style>
    </div>
  );
};

export default TokyoRatLanding;
